// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                    String          @id @default(cuid())
  email                 String?         @unique
  emailVerified         Boolean         @default(false)
  name                  String?
  avatarUrl             String?

  locale                String          @default("en")
  theme                 String          @default("system")

  credits               Int             @default(0)

  status                UserStatus      @default(ACTIVE)

  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt

  accounts              Account[]
  sessions              Session[]
  projects              Project[]
  usageLogs             UsageLog[]
  credit_transactions   CreditTransaction[]

  @@map("user")
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  DELETED
}

model Account {
  id                String          @id @default(cuid())
  userId            String

  provider          AuthProvider
  providerAccountId String?

  passwordHash      String?

  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])

  @@map("account")
}

enum AuthProvider {
  EMAIL
  GOOGLE
  GITHUB
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime

  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("session")
}

model VerificationToken {
  id        String   @id @default(cuid())
  identifier String
  token     String   @unique
  type      VerificationType
  expiresAt DateTime

  createdAt DateTime @default(now())

  @@index([identifier])
  @@map("verification_token")
}

enum VerificationType {
  EMAIL_VERIFY
  PASSWORD_RESET
}

model Project {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("project")
}

model UsageLog {
  id        String   @id @default(cuid())
  userId    String

  tool      String
  action    String
  credits   Int      @default(0)

  meta      Json?

  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("usage_logs")
}

model CreditTransaction {
  id        String   @id @default(cuid())
  userId    String

  amount    Int      // + or -
  reason    String

  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("credit_transactions")
}

