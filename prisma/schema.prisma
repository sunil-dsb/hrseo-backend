// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                    String                @id @default(cuid())
  email                 String?               @unique
  emailVerified         Boolean               @default(false)
  name                  String?
  avatarUrl             String?

  roleId                String
  locale                String                @default("en")
  theme                 String                @default("system")

  credits               Int                   @default(0)

  status                UserStatus            @default(ACTIVE)

  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt

  role                  Role?                 @relation(fields: [roleId], references: [id])
  accounts              Account[]
  sessions              Session[]
  projects              Project[]
  usageLogs             UsageLog[]
  credit_transactions   CreditTransaction[]

  @@map("user")
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  DELETED
}

model Account {
  id                String          @id @default(cuid())
  userId            String

  provider          AuthProvider
  providerAccountId String?

  passwordHash      String?

  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])

  @@map("account")
}

enum AuthProvider {
  EMAIL
  GOOGLE
  GITHUB
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime

  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("session")
}

model VerificationToken {
  id        String   @id @default(cuid())
  identifier String
  token     String   @unique
  type      VerificationType
  expiresAt DateTime

  createdAt DateTime @default(now())

  @@index([identifier])
  @@map("verification_token")
}

enum VerificationType {
  EMAIL_VERIFY
  PASSWORD_RESET
}

model Project {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("project")
}

model UsageLog {
  id        String   @id @default(cuid())
  userId    String

  tool      String
  action    String
  credits   Int      @default(0)

  meta      Json?

  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("usage_log")
}

model CreditTransaction {
  id        String   @id @default(cuid())
  userId    String

  amount    Int      // + or -
  reason    String

  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("credit_transaction")
}

// ---------------- RBAC ----------------

model Role {
  id                String        @id @default(cuid())
  name              String        @unique

  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  permissions       Permission[]
  user              User[]

  @@map("role")
}

model Module {
  id              String        @id @default(cuid())
  name            String        @unique

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  permissions     Permission[]

  @@map("module")
}

model Permission {
  id            String    @id @default(cuid())
  roleId        String
  moduleId      String
  canReadList   Boolean   @default(false)
  canReadSingle Boolean   @default(false)
  canCreate     Boolean   @default(false)
  canUpdate     Boolean   @default(false)
  canDelete     Boolean   @default(false)

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  role          Role?     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  module        Module?   @relation(fields: [moduleId], references: [id], onDelete: Cascade)

  @@map("permission")
}


// ------------ PLANS -------------

model Plan {
  id              String        @id @default(cuid())
  name            String        @unique
  description     String?
  price           Decimal       @db.Decimal(10, 2)
  currency        PlanCurrency
  isActive        Boolean       @default(true)

  features        Json

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@map("plan")
}

enum PlanCurrency {
  // English-speaking regions
  USD // United States Dollar
  GBP // British Pound
  CAD // Canadian Dollar
  AUD // Australian Dollar

  // Europe
  EUR // Euro
  CHF // Swiss Franc

  // Spanish-speaking countries
  MXN // Mexican Peso
  ARS // Argentine Peso
  COP // Colombian Peso
  CLP // Chilean Peso
  BRL // Brazilian Real

  // Asia
  INR // Indian Rupee
  JPY // Japanese Yen
  CNY // Chinese Yuan
  SGD // Singapore Dollar
  NZD // New Zealand Dollar
}
